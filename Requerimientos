
## üöÄ Instalaci√≥n
Primero instalremos Virtual box, dependiendo de su OS la instalcion podra variar, por eso recomiendo seguir los pasos de intalacion dados por Virtual box, aca esta el link de la pagina oficial:
```bash
https://www.virtualbox.org/wiki/Downloads
```

### M√ÅQUINAS  
Para virtualizar estas 4 m√°quinas virtuales se requiere de un virtualizador, en esta gu√≠a se utiliza **VirtualBox**, pero se puede usar cualquier otro programa con las mismas caracter√≠sticas.  
Se van a ejecutar 4 m√°quinas virtuales en total, estas van a ser:  
- Una m√°quina virtual con [PFsense](https://www.pfsense.org/download/)  
- Una m√°quina virtual con [Windows Server 2022](https://www.microsoft.com/es-es/evalcenter/download-windows-server-2022)  
- Una m√°quina virtual con [Windows 10](https://www.microsoft.com/es-es/software-download/windows10)  
- Una m√°quina virtual con [Linux Ubuntu](https://ubuntu.com/download/desktop)

### RED  
Dentro de VirtualBox utilizaremos 2 tipos de redes:  
* Una es la red WAN para dar internet.  
* Y la red LAN que viene por defecto en VirtualBox.

## INSTALACI√ìN Y CONFIGURACI√ìN DE M√ÅQUINAS

vamos a empezar con el tema de las maquinas Virtuales, iniciemos con:
### Pfsense

hay quue descargarlo del sitio web oficial, para esto les pasare el Link oficial,
```bash
https://www.pfsense.org/download/
```
Luego de descargar PFsense, hay que darle al bot√≥n de "Nuevo" en VirtualBox, se elige el archivo `.iso` y lo colocamos como "Type: Linux" y "Version: Other Linux x64".  
Antes de iniciar la m√°quina hay que darle <ins>click derecho</ins> y entrar en configuraci√≥n. Dentro de configuraci√≥n vamos a la pesta√±a <ins>Network</ins>, donde hay que habilitar el <ins>Adapter 2</ins>. Ah√≠ cambiamos la opci√≥n WAN por INTERNAL NETWORK, y en opciones avanzadas, en **Promiscuous Mode**, habilitamos **Allow All** y le damos a Accept.

Ahora iniciamos PFsense y, dentro de la instalaci√≥n, aceptamos todo hasta llegar a la **configuraci√≥n de red**, donde elegiremos cu√°l ser√° la red *WAN* y la red *LAN*.  
La red WAN ser√° la red NAT y la red LAN ser√° la red del <ins>Adapter 2</ins>. Luego de eso, elegimos el disco donde instalar el sistema y seleccionamos *Reboot*.

Luego de que se reinicie, nos dirigimos a *Devices*, luego a *Optical Units*, y destildamos la opci√≥n donde est√° la <ins>.iso</ins> de PFsense. Despu√©s reiniciamos el sistema.  
Con el sistema ya instalado, esperamos a que cargue por completo (esto puede tomar aproximadamente 1 o 2 minutos). Luego de que termine la carga, deber√≠an aparecer 16 opciones.

Para que PFsense detecte cu√°l es cada red, se asignan manualmente de esta manera:
* Elegimos la opci√≥n 1.
* En la opci√≥n de VLANs damos simplemente Enter.
* Cuando pida identificar la red WAN, hay que elegir la opci√≥n que est√© configurada en VirtualBox como Adapter 1.
* Cuando pida identificar la red LAN, hay que elegir la opci√≥n que est√© configurada en VirtualBox como Local Network, que en este caso ser√≠a Adapter 2.

> [!NOTE]  
> Teniendo en cuenta c√≥mo identifica las redes PFsense, se puede definir que Adapter1 = em0 - Adapter2 = em1 - Adapter3 = em2 - Adapter4 = em3. Siempre teniendo en cuenta que estamos utilizando VirtualBox.

Cuando se termine de configurar, hay que ir a la opci√≥n 2 donde:

* Seleccionaremos la red LAN con una opci√≥n num√©rica.
* Luego elegiremos la IP de la LAN (Ej: 192.168.1.1).
* Luego la m√°scara, que ser√° de 24.
* En la opci√≥n de ingresar una IP Gateway, simplemente se le da al bot√≥n Enter.
* En la opci√≥n de ingresar una IP v6, se da Enter nuevamente.
* Cuando se solicite elegir si queremos DHCP para la red LAN, damos "Y".
* El rango IP para el DHCP empezar√≠a (utilizando el ejemplo anterior) con 192.168.1.2 a 192.168.1.10. Luego damos Enter y esperamos a que se guarden los cambios.

Cuando se termine de configurar, nos va a dar una direcci√≥n web que, utilizando el ejemplo anterior, quedar√≠a "http://192.168.1.1/" y con eso ya estar√≠a terminada la configuraci√≥n de PFsense.

> [!IMPORTANT]  
> Para loguearse en la p√°gina de PFsense utilizar:  
> **Login**: admin  
> **Password**: pfsense

### <ins>Windows Server</ins>
Al colocar la ISO de Windows Server, esta se configura de manera autom√°tica. Para evitar esto, destildaremos la opci√≥n <ins>Skip Unattended Installation</ins> para poder configurarlo manualmente. Colocamos las especificaciones mencionadas en "Requisitos del sistema".  
Antes de iniciar la m√°quina, hay que ir a la configuraci√≥n y en la opci√≥n de Network elegiremos en Adapter1 la opci√≥n de "**Internal Network**".  
Al iniciar la instalaci√≥n dejaremos el lenguaje del sistema en ingl√©s, luego elegiremos la opci√≥n "Windows Server 2022 Datacenter Evolution (Desktop Edition)" y para finalizar elegimos la opci√≥n *Custom Install* y seleccionamos el *Drive 0* para que finalice la instalaci√≥n. Antes de reiniciarse, te pedir√° una contrase√±a para establecer el administrador, la cual es a gusto propio.  

Ya con la instalaci√≥n finalizada, hay que loguearse con la cuenta de *Administrator*. Ya en el inicio, dejamos que se inicie el $Server Manager$ y nos dirigimos a:
* Network Connections
  * Click derecho en Properties
    * Doble click en Internet Protocol V4

Aqu√≠ configuramos la direcci√≥n IP manualmente con alguna IP dentro del rango DHCP. Colocamos una m√°scara de /24, la Gateway va a ser la IP de la red LAN, y el servidor DNS va a ser la misma IP que colocamos como direcci√≥n IP. Tambi√©n, como DNS secundaria, se puede poner alguna de las bien conocidas como Google: 8.8.8.8 o 4.4.8.8.  

Para probar que la conexi√≥n es estable, se puede ingresar al servicio interno de PFsense que te da al finalizar la configuraci√≥n (en el ejemplo ser√≠a "http://192.168.1.1/"). Si entra, quiere decir que la conexi√≥n est√° establecida y que la red LAN funciona correctamente.  

> [!TIP]  
> Para m√°s comodidad a la hora de identificar las m√°quinas, se puede cambiar el nombre dirigi√©ndote al buscador: *About your PC* -> *Rename This PC* y cambiarlo a, por ejemplo, `WIN-AD`. Esto nos va a servir m√°s adelante.

Una vez conectado, hay que crear un servidor dedicado de **Active Directory**. Para esto, vamos al $Server Manager$ y nos dirigimos a:
* Add Roles and Features
  * Next tres veces seguidas
    * Buscamos y tildamos "Active Directory Domain Services"
      * Add Features
        * Next tres veces m√°s
          * Install

Esperamos a que se termine de instalar y luego clic en "Close". Seleccionamos el bander√≠n que se encuentra en la parte superior izquierda y nos dirigimos a la opci√≥n "Promote this server to a domain controller". Los siguientes pasos son:

* Seleccionar "Add New Forest"
  * En "Root Domain Name" colocar un nombre de dominio como "soc.lab" o "prueba.local", y luego Next
    * Elegimos una contrase√±a, la colocamos, repetimos en "Confirm Password" y damos Next
      * Dejar la parte de DNS por defecto y Next
        * El NetBIOS lo escribimos f√≠sicamente (en papel) para recordarlo y damos Next
          * Las siguientes dos opciones las dejamos por defecto y Next
            * Damos a Install y reiniciamos cuando se solicite

Una vez reiniciado, el Active Directory quedar√° activo.


---

### <ins>Windows 10</ins>
Luego de probar el funcionamiento de la red LAN en Windows Server, realizaremos el mismo proceso de instalaci√≥n con Windows 10. Antes de iniciar la m√°quina, hay que ir a la configuraci√≥n y en la opci√≥n de Network elegimos en Adapter1 la opci√≥n de "**Internal Network**".  
Al momento de instalar, dejamos el lenguaje del sistema en ingl√©s, la opci√≥n de Windows sin KEY y seleccionamos "Windows 10 Pro".

Ya con la instalaci√≥n finalizada, hay que loguearse. Ya en el inicio nos dirigimos a:
* Network Connections
  * Click derecho en Properties
    * Doble click en Internet Protocol V4

Aqu√≠ configuramos la direcci√≥n IP manualmente con alguna IP dentro del rango DHCP diferente a la que le dimos al Win-Server. Colocamos una m√°scara de /24, la Gateway ser√° la IP de la red LAN, y el servidor DNS ser√° la misma direcci√≥n IP que tiene Win-Server.  

Para probar que la conexi√≥n es estable, se puede ingresar al servicio interno de PFsense (por ejemplo, "http://192.168.1.1/"). Si puede acceder, quiere decir que la conexi√≥n est√° establecida y que la red LAN funciona correctamente.  

Una vez conectado a la red, nos dirigimos a:

* Settings
  * About your PC

Cambiaremos el nombre a uno m√°s f√°cil de recordar y <ins>reiniciaremos la PC</ins>. Una vez reiniciada, nos dirigimos al mismo lugar y buscamos la opci√≥n "Advanced System Settings", all√≠ elegimos "Change domain or workgroup name", y en la opci√≥n "Member of Domain:" escribimos el "**NetBIOS**" que guardamos anteriormente.  
Una vez colocado, solicitar√° un usuario y contrase√±a de ese dominio, y usaremos la cuenta de administrador del Windows Server. Una vez dentro del dominio, damos OK y reiniciamos cuando se solicite.  
De esta forma, estar√° dentro del dominio y conectado a Windows Server.

---

### <ins>Linux/Ubuntu</ins>
Una vez que Active Directory (Windows Server) est√© conectado con la m√°quina Win10, hay que crear la zona de monitoreo SIEM.  
Para esto, creamos la m√°quina virtual con la configuraci√≥n indicada en "Requisitos del Sistema".  
Antes de iniciar la m√°quina, vamos a la configuraci√≥n y en la opci√≥n de Network elegimos en Adapter1 la opci√≥n de "**Internal Network**".  
Sigue la instalaci√≥n y, al ingresar al escritorio, configuramos la red.  

La misma se configura desde la parte superior derecha:
* Wired Connected
  * Wired Settings
    * Clic en la "tuerca"
      * Ir a la pesta√±a "IPv4"

Aqu√≠ configuramos la direcci√≥n IP manualmente con alguna IP dentro del rango DHCP diferente a la de Win-Server y Win10. Colocamos una m√°scara de /24, la Gateway ser√° la IP de la red LAN, y el servidor DNS ser√° la misma IP que tiene Win-Server.  

Para probar que la conexi√≥n es estable, accedemos a "http://192.168.1.1/" (ejemplo). Si accede, la red LAN funciona correctamente.

---

## ElasticSIEM
Para instalar **ElasticSIEM**, se requieren tres sistemas: Java, Elasticsearch y Kibana.  
Estos se instalan en la terminal de Linux con los siguientes comandos.  

Primero, instalamos Java:

```bash
sudo apt update && sudo apt upgrade -y
sudo apt install -y openjdk-17-jdk
```

Despu√©s, descargamos e instalamos Elasticsearch:

```bash
wget https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-8.9.0-amd64.deb
sudo dpkg -i elasticsearch-8.9.0-amd64.deb
```

Y habilitamos el servicio:

```bash
sudo systemctl enable elasticsearch
sudo systemctl start elasticsearch
```

> [!TIP]  
> Para verificar si el programa corre correctamente, se puede usar:  
> `sudo systemctl status elasticsearch`

Luego de instalar Elastic, hay que <ins>configurarlo</ins>.  
El archivo se encuentra en: `/etc/elasticsearch/elasticsearch.yml`  
Podemos editarlo con:

```bash
sudo nano /etc/elasticsearch/elasticsearch.yml
```

Dentro del archivo de configuraci√≥n, busca y edita las siguientes l√≠neas (quitando el `#` al inicio):

```yml
network.host: "192.168.0.1"
http.port: 9200
xpack.security.http.ssl.enabled: true
xpack.security.transport.ssl.enabled: true
```

> [!IMPORTANT]  
> Todas las l√≠neas que contienen `#` est√°n comentadas. Quitar el `#` en las l√≠neas que quieras configurar.

Estas configuraciones se copian del archivo [Documentaci√≥n-Elastic](Documentaci√≥n/Documentaci√≥n-Elastic.txt).

Una vez configurado, reiniciamos el servicio:

```bash
sudo systemctl restart elasticsearch
```

En el navegador del sistema, colocamos `http://localhost:9200`.  
Nos pedir√° usuario y contrase√±a, los cuales conseguimos con el siguiente comando:

```bash
sudo /usr/share/elasticsearch/bin/elasticsearch-reset-password -u elastic
```

El resultado ser√° una l√≠nea indicando:  
`New value: TU_CONTRASE√ëA_ELASTIC`

Esta ser√° la contrase√±a del usuario "elastic".  
Gu√°rdala en un archivo `.txt` en el escritorio.  
Al recargar la URL, coloca:

**User**: elastic  
**Password**: TU_CONTRASE√ëA_ELASTIC  

La p√°gina mostrar√° el nombre de sistema y algunos datos que indican que est√° en funcionamiento.

---

### <ins>Kibana</ins>
Una vez terminada la instalaci√≥n de Elastic, descargamos e instalamos Kibana con el comando:

	wget https://artifacts.elastic.co/downloads/kibana/kibana-8.9.0-amd64.deb
	sudo dpkg -i kibana-8.9.0-amd64.deb

Luego de descargarlo, se activa el programa con:

	sudo systemctl enable kibana
	sudo systemctl start kibana

Una vez activo el programa, se debe cambiar la contrase√±a de Kibana para acceder a Elastic. Para esto, utilizamos el comando:

	sudo /usr/share/elasticsearch/bin/elasticsearch-reset-password -u kibana_system
 
Dejar√° una l√≠nea que indica "New value: TU_CONTRASE√ëA_KIBANA", la cual es la contrase√±a para el usuario kibana_system. Esta contrase√±a tambi√©n se debe guardar en el archivo .txt para usar m√°s adelante.<br/>
Ya con la contrase√±a, se pasa a configurar Kibana. Utiliza el comando "[sudo nano /etc/kibana/kibana.yml]" y busca las l√≠neas a editar:

	#server.port: 5601
 	#server.host: ""
  	#server.publicBaseUrl:
   	#elasticsearch.hosts: ["http://localhost:9200"]
    #elasticsearch.username: "kibana_system"
	#elasticsearch.password: "pass"

Estas se deben configurar copiando las l√≠neas indicadas del archivo de [Configuraci√≥n Kibana](Documentaci√≥n/Configuraci√≥n-Kibana.txt).<br/>
Una vez configurado, se reinician los dos programas:

	sudo systemctl restart elasticsearch
	sudo systemctl restart kibana

Al finalizar, los programas pueden tardar en iniciarse aproximadamente 2 minutos. Luego de ese tiempo tendr√°s [http://localhost:9200], donde muestra que Elastic est√° activo, y "[<ins>http://localhost:5601</ins>]", donde tendr√°s el Elastic de forma gr√°fica. Luego de ingresar, pulsas el bot√≥n que diga "I explore for my own" y tendr√°s el sistema en completo funcionamiento.
## Sysmon y Winlogbeat
Para poder enviar logs desde Win10 y Win-Server al sistema de Elastic, hay que conectar ambos sistemas utilizando <ins>Sysmon y Winlogbeat</ins>. Ambas configuraciones funcionan igual para los dos sistemas, con lo cual habr√° que repetir el proceso por cada uno.

### <ins>Sysmon</ins>
Para este programa, hay que descargarlo desde [https://docs.microsoft.com/en-us/sysinternals/downloads/sysmon]. Una vez descargado, se extrae en la ruta [C:\Sysmon\]. Ya con la carpeta extra√≠da, descargamos la configuraci√≥n, siendo este el √∫ltimo componente.<br/>
> [!NOTE]
> Este archivo se puede descargar por internet y hay varias versiones hechas por la comunidad, mayormente se encuentran en GitHub.
<br/>

En esta gu√≠a se utiliza una configuraci√≥n descargada utilizando la terminal de PowerShell como **Administrador**, con el siguiente comando:

	Invoke-WebRequest -Uri "https://raw.githubusercontent.com/SwiftOnSecurity/sysmon-config/master/sysmonconfig-export.xml" -OutFile "C:\Sysmon\sysmonconfig.xml"

Con la configuraci√≥n descargada, se ejecuta el programa utilizando PowerShell como administrador:

	C:\Sysmon\Sysmon64.exe -accepteula -i C:\Sysmon\sysmonconfig.xml

Para verificar que Sysmon est√© en funcionamiento, se puede utilizar el siguiente comando. Si este no muestra logs o da alg√∫n error, significa que hubo un problema con la instalaci√≥n:

	Get-WinEvent -LogName "Microsoft-Windows-Sysmon/Operational" -MaxEvents 10 | Format-List

Una vez instalado, es necesario enviar los logs que genere Sysmon a Elastic. Esto se har√° con Winlogbeat, el cual se encarga de conectar ambas m√°quinas virtuales (Win10 y Win-Server) a Elastic.

### <ins>Winlogbeat</ins>
Este programa es compatible con Elastic y se puede descargar desde su p√°gina: [https://www.elastic.co/downloads/beats/winlogbeat].  
Una vez descargado el archivo .zip, se descomprime en la ruta [C:\Program Files\Winlogbeat\].  
Dentro de la carpeta, busca el archivo `winlogbeat.yml` y config√∫ralo utilizando el bloc de notas. Las l√≠neas a editar o agregar son las siguientes:

> [!IMPORTANT]  
> Dentro de Windows, as√≠ como en Linux, todas las l√≠neas del archivo `.yml` que contengan <ins>"#"</ins> quedar√°n como configuraci√≥n predeterminada. A las l√≠neas que se deben editar se les debe quitar el "#".
<br/>

	#winlogbeat.event_logs:
	  - name: Application

	  - name: System

	  - name: Security

	#host: "localhost:5601"
	#hosts: ["localhost:9200"]
	#protocol: "http"
	#username: "elastic"
	#password: "changeme"
	#ssl.verification_mode:

Las l√≠neas a editar o agregar se encuentran en [Configuraci√≥n Winlogbeat](Documentaci√≥n/Configuraci√≥n-Winlogbeat.txt).<br/>
Una vez editado el archivo, ejecutamos PowerShell como administrador y para dirigirse a la carpeta donde est√° Winlogbeat, utiliza el comando:

	cd 'C:\Program Files\Winlogbeat'

Ya en el directorio, ejecutas:

	.\install-service-winlogbeat.ps1
	Start-Service winlogbeat

Luego de instalar, podemos verificar de dos formas:  
Una es entrando a *Services* y buscando el programa.  
La otra opci√≥n es ejecutar en PowerShell como administrador el siguiente comando:

	.\winlogbeat.exe setup -e

Este muestra los logs recogidos por el programa.

### <ins>Conexi√≥n con Elastic</ins>
Cuando ambos sistemas operativos tengan instalado Sysmon y Winlogbeat, se deben implementar en ElasticSIEM.
<br/>
Dentro de ElasticSIEM, dir√≠gete a [Men√∫ lateral ‚Üí Analytics ‚Üí Discover] y selecciona "<ins>Add Integrations</ins>".  
Luego de agregar esta integraci√≥n, vas a ver en la pesta√±a <ins>Discover</ins>, sobre la parte superior izquierda, una pesta√±a que muestra los **Data View**. En esa pesta√±a busca el recuadro de "<ins>Winlogbeat-*</ins>".<br/>
`Winlogbeat-*` muestra los logs de los sistemas Windows en una sola pesta√±a. En esta se ve una [TimeLine](Capturas/Captura-Logs-1.png) en la cual se va mostrando la cantidad de [alertas](Capturas/Captura-Logs-2.png) que muestra Winlogbeat a lo largo del tiempo.<br/>
Por otro lado, dir√≠gete a [Men√∫ lateral ‚Üí Security ‚Üí Alerts], donde se encuentra la informaci√≥n de estas [alertas](Capturas/Captura-Alertas-1.png), en las cuales se [filtran y categorizan](Capturas/Captura-Alertas-2.png) para una mejor detecci√≥n.<br/>
Contando con estas dos funciones, m√°s otras que ya vienen integradas en el paquete ElasticSIEM, es posible hacer pruebas de ataques simulados.

## Simulaci√≥n de ataques

Teniendo un entorno SIEM funcional, es momento de comprometerlo para comprobar sus funcionalidades. Para esto se va a utilizar <ins>**BadBlood**</ins> para comprometer Windows Server y <ins>**Atomic Red Team**</ins> para comprometer Windows 10.

### <ins>BadBlood</ins>
BadBlood es un malware sencillo de descargar e instalar. Para realizar la descarga, ingresa al link de [GitHub](https://github.com/davidprowe/BadBlood), descarga el .zip y extrae el contenido en cualquier ubicaci√≥n.<br/>
Una vez extra√≠do, ingresa como administrador a PowerShell y ejecuta los siguientes comandos:

	cd .\Downloads\BadBlood-Master\BadBlood-Master\

Luego de ingresar a la carpeta del malware, este se ejecuta con:

	.\invoke-BadBlood.ps1

Con esto aparecer√° un peque√±o p√°rrafo explicativo como gu√≠a para ejecutarlo. Una vez ejecutado, deja que la magia suceda (esto puede tomar varios minutos).<br/>
Una vez terminado el proceso, en ElasticSIEM, en la pesta√±a de *Discover*, deber√≠an haberse registrado varios logs y eventos relacionados con la creaci√≥n de usuarios, roles y eventos en Win-Server.
### <ins>Atomic Red Team</ins>
Atomic Red Team es un programa un poco m√°s complejo de instalar y ejecutar. Primero es necesario desactivar Windows Defender, para esto hay que dirigirse a [<ins> Men√∫ del buscador ‚Üí Settings ‚Üí Update & Security ‚Üí Windows Defender ‚Üí Virus & Threat Protection ‚Üí Virus & Threat Protection Settings ‚Üí Manage Settings </ins>]. En esta pesta√±a desactiva todas las opciones. Una vez desactivado, el √∫ltimo paso es ejecutar el comando:

	Set-MpPreference -DisableRealtimeMonitoring $true

Despu√©s, para que PowerShell pueda instalar las dependencias, necesita el m√≥dulo ".yaml", el cual se instala con: 

	Install-Module powershell-yaml -Force -Scope CurrentUser
	Import-Module powershell-yaml

Con el antivirus completamente desactivado, se deben descargar dos carpetas. La primera es [atomic-red-team-master](https://github.com/redcanaryco/atomic-red-team.git) y la segunda es [invoke-atomicredteam-master](https://github.com/redcanaryco/invoke-atomicredteam.git), ambas se encuentran en GitHub descargando el archivo .zip.<br/>
Antes de extraerlos se debe crear una carpeta con nombre "AtomicRedTeam" en la carpeta "C:\" (disco local). Estos archivos descargados se deben descomprimir en la carpeta AtomicRedTeam, all√≠ deber√≠a quedar:
	
 	C:\AtomicRedTeam\
	    ‚îî‚îÄ‚îÄ atomic-red-team-master\
	    ‚îú    ‚îî‚îÄ‚îÄ atomic-red-team-master\
	    ‚îú    	‚îú‚îÄ‚îÄ .devcontainer\
	    ‚îú    	‚îú‚îÄ‚îÄ atomics\
        ‚îú		‚îî‚îÄ‚îÄ ...\	
	    ‚îî‚îÄ‚îÄ invoke-atomicredteam-master\
	         	‚îî‚îÄ‚îÄ invoke-atomicredteam-master\
	         		‚îú‚îÄ‚îÄ .git\
	    			‚îú‚îÄ‚îÄ docker\
	         		‚îî‚îÄ‚îÄ ...
 
Como se puede ver, ambos archivos al extraerlos crean una carpeta del mismo nombre dentro de su propia carpeta con el contenido necesario. Para evitar problemas con los comandos que se deben ejecutar, se debe quitar la carpeta intermedia con nombre repetido para tener una ruta m√°s corta, adem√°s de mover la carpeta "\atomics" a la ruta "C:\AtomicRedTeam\". Esto deber√≠a quedar as√≠:

  	C:\AtomicRedTeam\
	    ‚îú‚îÄ‚îÄ atomic-red-team-master\
	    ‚îú 	 ‚îî‚îÄ‚îÄ .devcontainer\
	    ‚îú	 ‚îî‚îÄ‚îÄ ...
	    ‚îú‚îÄ‚îÄ atomics\
	    ‚îú	 ‚îî‚îÄ‚îÄ indexes\
	    ‚îú	 ‚îî‚îÄ‚îÄ ...
	    ‚îî‚îÄ‚îÄ invoke-atomicredteam-master\
	         ‚îî‚îÄ‚îÄ .git\
	         ‚îî‚îÄ‚îÄ ...

Una vez las carpetas est√©n colocadas correctamente, se debe instalar. En este repositorio se explicar√° el paso a paso de esta versi√≥n. En caso de encontrarte con un error no dudes en consultar con la [Wiki](https://github.com/redcanaryco/invoke-atomicredteam/wiki) de Atomic Red Team. Primero se debe ingresar a PowerShell como administrador y ejecutar:

	powershell -exec bypass

Luego de que se recargue PowerShell se debe ejecutar:

	Install-Module -Name invoke-atomicredteam,powershell-yaml -Scope CurrentUser

Finalizada la instalaci√≥n del m√≥dulo, se debe verificar que se instal√≥ correctamente con el c√≥digo:

	Get-Module

Si al ejecutarlo aparece "Invoke-AtomicRedTeam" en la lista de m√≥dulos quiere decir que el programa se instal√≥ satisfactoriamente. Para poder simular un ataque es necesario ingresar un c√≥digo. Este c√≥digo es el que se usa para categorizar ataques en la organizaci√≥n ["MITRE ATT&CK"](https://attack.mitre.org/matrices/enterprise/).<br/>

> [!NOTE]  
> El link que est√° atado a MITRE ATT&CK lleva a un cuadro con todos los ataques categorizados. Si a estos les pasas el mouse por encima ver√°s un c√≥digo como "T1548" o "T1016". Estos son los c√≥digos utilizados para lanzar ataques con Atomic Red Team.
<br/>

Para iniciar un ataque se debe utilizar el comando `Invoke-AtomicTest` seguido de un c√≥digo de ataque. Tambi√©n se le puede agregar tags al final de la l√≠nea como por ejemplo `-ShowDetailsBrief`, que muestra una lista de funciones del ataque en concreto, o `-CheckPrereqs`, el cual muestra una lista de requisitos para que se pueda ejecutar el ataque (mayormente siempre se cumplen los requisitos, ya que son programas que vienen incluidos con Windows).<br/>
Para poder generar logs, ejecuta algunos ataques, los cuales tendr√≠an que salir en ElasticSIEM. Tambi√©n mencionar que, en caso de alg√∫n error en el proceso, se puede verificar utilizando el [video de YT](https://www.youtube.com/watch?v=_xW3fAumh1c) que se utiliz√≥ para hacer la parte de Atomic en esta gu√≠a.

## Pasos finales y pr√°ctica
Luego de tener ejecutados ambos malwares en los sistemas operativos, siendo BadBlood en Win-Server y alg√∫n ataque a elecci√≥n en Atomic Red Team, se va a tener acceso a gran cantidad de logs generados que env√≠a Winlogbeat a ElasticSIEM. Con estos se puede hacer el seguimiento para verificar c√≥mo se desarrolla un malware en un entorno controlado y cu√°les son sus paso a paso para lograr infectar un Sistema Operativo.<br/>
<br/>
Dentro de la parte **pr√°ctica**, se puede explorar el sistema Elastic para conocer todas sus funciones. A modo personal, para realizar esta gu√≠a le solicit√© a **<ins>ChatGPT</ins>** que me d√© desaf√≠os en los cuales me indicara qu√© malware ejecutar en Atomic Red Team y responder una serie de preguntas.<br/>
<br/>
<br/>
<br/>
Con un sistema SIEM como Elastic se pueden realizar gran cantidad de acciones con las cuales se puede aprender con cada prueba que se hace. Este proyecto no es una soluci√≥n definitiva, sino un entorno para practicar y mejorar en el proceso. Si llegaste hasta ac√°, o si te sirve de inspiraci√≥n para construir tu propio laboratorio SOC, significa que vali√≥ la pena, ya que lo que me mueve es la curiosidad constante y las ganas de seguir aprendiendo.
